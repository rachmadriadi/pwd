<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Password Gunung Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .animate-bounce-short {
            animation: bounce-short 0.3s ease-in-out 1;
        }
        @keyframes bounce-short {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="glass-panel w-full max-w-md rounded-2xl p-6 md:p-8 space-y-6">
        
        <!-- Header -->
        <div class="text-center space-y-2">
            <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 mb-2">
                <i class="fa-solid fa-mountain text-xl"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-800">Sandi Gunung</h1>
            <p class="text-gray-500 text-sm">Generator password berbasis nama gunung Indonesia</p>
        </div>

        <!-- Output Section -->
        <div class="relative group">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa-solid fa-key text-gray-400"></i>
            </div>
            <input type="text" id="passwordOutput" readonly 
                class="block w-full pl-10 pr-12 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-gray-800 font-mono text-lg font-bold focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all outline-none text-center"
                placeholder="Klik Generate...">
            
            <button onclick="copyPassword()" class="absolute inset-y-0 right-0 px-4 text-gray-400 hover:text-emerald-600 transition-colors" title="Salin Password">
                <i class="fa-regular fa-copy text-xl"></i>
            </button>
        </div>

        <!-- Feedback Info -->
        <div id="mountainInfo" class="hidden text-center bg-blue-50 text-blue-700 px-3 py-2 rounded-lg text-sm font-medium border border-blue-100">
            <!-- Will be filled by JS -->
        </div>

        <!-- Controls -->
        <div class="space-y-4 bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
            
            <!-- Output Format Toggle -->
            <div class="flex p-1 bg-gray-100 rounded-lg">
                <button onclick="setMode('plain')" id="btnPlain" class="flex-1 py-1.5 px-3 rounded-md text-sm font-medium transition-all bg-white text-gray-800 shadow-sm">
                    Plain Text
                </button>
                <button onclick="setMode('postgres')" id="btnPostgres" class="flex-1 py-1.5 px-3 rounded-md text-sm font-medium transition-all text-gray-500 hover:text-gray-700">
                    PostgreSQL
                </button>
            </div>

            <!-- Postgres Settings (Hidden by default) -->
            <div id="pgSettings" class="hidden space-y-3 animate-bounce-short border-t border-dashed border-gray-200 pt-3">
                
                <div class="grid grid-cols-3 gap-2">
                    <!-- Command Type -->
                    <div class="col-span-1">
                        <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide block mb-1">Tipe</label>
                        <select id="pgCommandType" onchange="generatePassword()" class="w-full py-2 px-2 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="CREATE">CREATE</option>
                            <option value="ALTER">ALTER</option>
                            <option value="PGPASS">.pgpass</option>
                        </select>
                    </div>

                    <!-- Username Input -->
                    <div class="col-span-2">
                        <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide block mb-1">Username / Role</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-2.5 flex items-center text-gray-400">
                                <i class="fa-solid fa-user text-xs"></i>
                            </span>
                            <input type="text" id="pgUsername" value="postgres" oninput="generatePassword()"
                                class="w-full pl-8 pr-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none placeholder-gray-400"
                                placeholder="nama_user">
                        </div>
                    </div>
                </div>

                <!-- Host info for pgpass (Only visible if PGPASS selected) -->
                <div id="pgPassInfo" class="hidden">
                     <label class="text-[10px] font-bold text-gray-400 uppercase tracking-wide block mb-1">Host:Port:DB</label>
                     <input type="text" id="pgHostCtx" value="localhost:5432:*" oninput="generatePassword()"
                        class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none font-mono text-gray-600"
                        placeholder="localhost:5432:*">
                </div>
            </div>

            <!-- Length Slider -->
            <div class="space-y-2">
                <div class="flex justify-between text-sm font-medium text-gray-700">
                    <label>Panjang Karakter</label>
                    <span id="lengthVal" class="text-emerald-600 font-bold">12</span>
                </div>
                <input type="range" id="lengthRange" min="8" max="24" value="12" 
                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
            </div>

            <!-- Options -->
            <div class="grid grid-cols-2 gap-3">
                <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50">
                    <input type="checkbox" id="useSymbols" checked class="w-4 h-4 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
                    <span class="text-sm text-gray-600">Simbol (!@#)</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50">
                    <input type="checkbox" id="useNumbers" checked class="w-4 h-4 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300">
                    <span class="text-sm text-gray-600">Angka (123)</span>
                </label>
            </div>
        </div>

        <!-- Generate Button -->
        <button onclick="generatePassword()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3.5 px-4 rounded-xl shadow-lg shadow-emerald-200 transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
            <i class="fa-solid fa-arrows-rotate"></i>
            Generate Password
        </button>

        <!-- Notification Toast -->
        <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none z-50 flex items-center gap-2">
            <i class="fa-solid fa-check-circle text-green-400"></i>
            <span>Tersalin ke Clipboard!</span>
        </div>

    </div>

    <script>
        // Database Gunung Indonesia
        const mountains = [
            "Semeru", "Rinjani", "Kerinci", "Bromo", "Merapi", "Latimojong", "Binaiya", 
            "BukitRaya", "Slamet", "Sanggar", "Rantemario", "Merbabu", "Ijen", "Tambora", 
            "Krakatau", "Agung", "Batur", "Lawu", "Arjuno", "Raung", "Ciremai", "Salak", 
            "Gede", "Pangrango", "Papandayan", "Kelud", "Sinabung", "Marapi", "Dempo", 
            "Leuser", "Tangkuban", "Prau", "Sindoro", "Sumbing", "Ungaran"
        ];

        // Peta Substitusi Karakter (Leet Speak)
        const substitutions = {
            'a': ['@', '4', 'a', 'A'],
            'i': ['!', '1', 'i', 'I', '|'],
            'e': ['3', 'e', 'E'],
            'o': ['0', 'o', 'O'],
            's': ['$', '5', 's', 'S'],
            't': ['7', '+', 't', 'T'],
            'g': ['9', 'g', 'G'],
            'b': ['8', 'b', 'B']
        };

        const symbols = "!@#$%^&*()_+~`|}{[]:;?><,./-=";
        const numbers = "0123456789";
        
        let currentMode = 'plain'; // 'plain' or 'postgres'

        // Update Slider Value Display
        const rangeInput = document.getElementById('lengthRange');
        const lengthVal = document.getElementById('lengthVal');
        
        rangeInput.addEventListener('input', function() {
            lengthVal.textContent = this.value;
        });

        // Toggle Command Type visibility
        document.getElementById('pgCommandType').addEventListener('change', function() {
            const isPgPass = this.value === 'PGPASS';
            document.getElementById('pgPassInfo').classList.toggle('hidden', !isPgPass);
            generatePassword();
        });
        
        function setMode(mode) {
            currentMode = mode;
            const btnPlain = document.getElementById('btnPlain');
            const btnPg = document.getElementById('btnPostgres');
            const pgSettings = document.getElementById('pgSettings');
            
            if (mode === 'postgres') {
                btnPlain.classList.remove('bg-white', 'text-gray-800', 'shadow-sm');
                btnPlain.classList.add('text-gray-500');
                
                btnPg.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                btnPg.classList.remove('text-gray-500');
                
                pgSettings.classList.remove('hidden');
            } else {
                btnPg.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                btnPg.classList.add('text-gray-500');
                
                btnPlain.classList.add('bg-white', 'text-gray-800', 'shadow-sm');
                btnPlain.classList.remove('text-gray-500');
                
                pgSettings.classList.add('hidden');
            }
            generatePassword();
        }

        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
        }

        function generatePassword() {
            const length = parseInt(rangeInput.value);
            const useSym = document.getElementById('useSymbols').checked;
            const useNum = document.getElementById('useNumbers').checked;

            // 1. Pilih Gunung
            const mountainName = mountains[getRandomInt(mountains.length)];
            let finalPassword = "";

            // 2. Loop: Ulangi nama gunung dengan variasi sampai panjang terpenuhi
            // Menggunakan logika REPETISI (Prau -> Pr4uPr@U) bukan padding acak (Prau -> Pr4uxyZ12)
            let safetyCount = 0;
            while (finalPassword.length < length && safetyCount < 100) {
                let chunk = "";
                
                for (let i = 0; i < mountainName.length; i++) {
                    const char = mountainName[i].toLowerCase();
                    let newChar = char; // default

                    // Cek Substitusi (Leet Speak)
                    if (substitutions[char] && Math.random() > 0.2) { 
                        const options = substitutions[char];
                        const candidate = options[getRandomInt(options.length)];
                        
                        // Cek Validasi Checkbox (Agar sesuai setting user)
                        const isNum = /[0-9]/.test(candidate);
                        const isSym = /[^a-zA-Z0-9]/.test(candidate);
                        
                        // Jika dapat angka tapi user tidak centang Angka, batalkan substitusi
                        if (isNum && !useNum) {
                            newChar = (Math.random() > 0.5) ? char.toUpperCase() : char;
                        } 
                        // Jika dapat simbol tapi user tidak centang Simbol, batalkan substitusi
                        else if (isSym && !useSym) {
                            newChar = (Math.random() > 0.5) ? char.toUpperCase() : char;
                        } 
                        else {
                            newChar = candidate;
                        }
                    } else {
                        // Random Case (Besar/Kecil) jika tidak ada substitusi
                        newChar = (Math.random() > 0.5) ? char.toUpperCase() : char;
                    }
                    chunk += newChar;
                }
                
                finalPassword += chunk;
                safetyCount++;
            }

            // 3. Potong sesuai panjang slider
            finalPassword = finalPassword.slice(0, length);

            // Formatting Output
            const output = document.getElementById('passwordOutput');
            
            if (currentMode === 'postgres') {
                const username = document.getElementById('pgUsername').value.replace(/[^a-zA-Z0-9_]/g, '') || 'user';
                const cmdType = document.getElementById('pgCommandType').value;
                const safePass = finalPassword.replace(/'/g, "''"); // Escape single quote for SQL
                const pgPassSafe = finalPassword.replace(/:/g, "\\:"); // Escape colon for pgpass
                
                if (cmdType === 'CREATE') {
                    output.value = `CREATE USER "${username}" WITH ENCRYPTED PASSWORD '${safePass}';`;
                } else if (cmdType === 'ALTER') {
                    output.value = `ALTER USER "${username}" WITH ENCRYPTED PASSWORD '${safePass}';`;
                } else if (cmdType === 'PGPASS') {
                    const hostCtx = document.getElementById('pgHostCtx').value || 'localhost:5432:*';
                    output.value = `${hostCtx}:${username}:${pgPassSafe}`;
                }

                output.style.fontSize = "0.85rem"; // Kecilkan font agar muat
            } else {
                output.value = finalPassword;
                output.style.fontSize = "1.125rem"; // Reset font size
            }
            
            // Animasi kecil
            output.classList.remove('animate-bounce-short');
            void output.offsetWidth; // trigger reflow
            output.classList.add('animate-bounce-short');

            // Info Gunung
            const infoBox = document.getElementById('mountainInfo');
            infoBox.innerHTML = `Basis: <strong>Gunung ${mountainName}</strong>`;
            infoBox.classList.remove('hidden');
        }

        function copyPassword() {
            const output = document.getElementById('passwordOutput');
            if (!output.value) return;

            // Copy logic
            output.select();
            output.setSelectionRange(0, 99999); // Untuk mobile
            
            // Menggunakan Clipboard API modern jika tersedia, fallback ke execCommand
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(output.value).then(() => showToast());
            } else {
                document.execCommand('copy');
                showToast();
            }
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 2000);
        }

        // Generate on load
        window.onload = generatePassword;

    </script>
</body>
</html>